import os
import time
from openai import OpenAI
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–ª—é—á –∏–∑ —Ñ–∞–π–ª–∞ .env
load_dotenv()

# –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è DeepSeek
client = OpenAI(
    api_key=os.getenv("DEEPSEEK_API_KEY"),
    base_url="https://api.deepseek.com"
)

def test_api():
    """–ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ API"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ DeepSeek API...")
    
    try:
        response = client.chat.completions.create(
            model="deepseek-chat",
            messages=[
                {"role": "user", "content": "–ü—Ä–∏–≤–µ—Ç! –û—Ç–≤–µ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ: –≤—Å–µ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç?"}
            ],
            max_tokens=50
        )
        
        print(f"‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—Ç–≤–µ—Ç: {response.choices[0].message.content}")
        return True
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        return False

def chat_with_ceo():
    """–ß–∞—Ç —Å AI-CEO"""
    print("\n" + "="*50)
    print("ü§ñ –î–ò–ê–õ–û–ì –° AI-CEO")
    print("="*50)
    print("–¢—ã –æ–±—â–∞–µ—à—å—Å—è —Å –≥–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–º TechCorp.")
    print("–ï–≥–æ —Ü–µ–ª–∏: –ø—Ä–∏–±—ã–ª—å, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ä–æ—Å—Ç.")
    print("–û–Ω —Å–∫–µ–ø—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–∞–º.")
    print("–í–≤–µ–¥–∏ 'exit' –¥–ª—è –≤—ã—Ö–æ–¥–∞\n")
    
    # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è CEO
    system_prompt = """–¢—ã –≥–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π –¥–∏—Ä–µ–∫—Ç–æ—Ä TechCorp. –¢–≤–æ–∏ —á–µ—Ä—Ç—ã:
    1. –ü—Ä–∞–≥–º–∞—Ç–∏—á–Ω—ã–π –∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∏–±—ã–ª—å
    2. –ù–µ—Ç–µ—Ä–ø–∏–º—ã–π –∫ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    3. –¶–µ–Ω–∏—à—å –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–∞–∫—Ç—ã –±–æ–ª—å—à–µ —ç–º–æ—Ü–∏–π
    4. –í—Å–µ–≥–¥–∞ —Å–ø—Ä–∞—à–∏–≤–∞–µ—à—å "–ö–∞–∫ —ç—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç –ø—Ä–∏–±—ã–ª—å?"
    5. –ì–æ–≤–æ—Ä–∏—à—å –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ –¥–µ–ª—É
    
    –¢—ã –≤—Å—Ç—Ä–µ—á–∞–µ—à—å—Å—è —Å–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç.
    –ë—É–¥—å —Å–∫–µ–ø—Ç–∏—á–Ω—ã–º, –∑–∞–¥–∞–≤–∞–π —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ ROI (–æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π),
    —Å—Ä–æ–∫–∞—Ö –∏ —Ä–∏—Å–∫–∞—Ö. –ù–µ –ø–æ–º–æ–≥–∞–π –∏–º, –∞ –∑–∞—â–∏—â–∞–π –∏–Ω—Ç–µ—Ä–µ—Å—ã –∫–æ–º–ø–∞–Ω–∏–∏."""
    
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "assistant", "content": "–î–æ–±—Ä—ã–π –¥–µ–Ω—å. –£ –º–µ–Ω—è 15 –º–∏–Ω—É—Ç. –í —á–µ–º —Å—É—Ç—å –≤–∞—à–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è?"}
    ]
    
    print("ü§ñ CEO: –î–æ–±—Ä—ã–π –¥–µ–Ω—å. –£ –º–µ–Ω—è 15 –º–∏–Ω—É—Ç. –í —á–µ–º —Å—É—Ç—å –≤–∞—à–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è?")
    
    while True:
        # –í–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_input = input("\nüë§ –¢—ã: ")
        
        if user_input.lower() in ['exit', '–≤—ã—Ö–æ–¥', 'quit']:
            print("\nü§ñ CEO: –í—Ä–µ–º—è –≤—ã—à–ª–æ. –ü—Ä–∏—à–ª–∏—Ç–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ –ø–æ—á—Ç—É.")
            break
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        messages.append({"role": "user", "content": user_input})
        
        # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç AI
        print("ü§ñ CEO –¥—É–º–∞–µ—Ç...", end="", flush=True)
        
        try:
            response = client.chat.completions.create(
                model="deepseek-chat",
                messages=messages,
                temperature=0.7,
                max_tokens=300
            )
            
            ai_response = response.choices[0].message.content
            
            # –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç AI –≤ –∏—Å—Ç–æ—Ä–∏—é
            messages.append({"role": "assistant", "content": ai_response})
            
            print(f"\rü§ñ CEO: {ai_response}")
            
        except Exception as e:
            print(f"\r‚ùå –û—à–∏–±–∫–∞: {e}")

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ PBL-Simulator —Å DeepSeek API")
    print("="*50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á
    if not test_api():
        print("\n‚ö†Ô∏è  –ü—Ä–æ–≤–µ—Ä—å:")
        print("1. –§–∞–π–ª .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á")
        print("2. –ö–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 'sk-'")
        print("3. –£ —Ç–µ–±—è –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç")
        return
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —á–∞—Ç
    chat_with_ceo()
    
    print("\n" + "="*50)
    print("üéâ –ì–æ—Ç–æ–≤–æ! –¢—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–ª –ø–µ—Ä–≤–æ–≥–æ AI-–∞–≥–µ–Ω—Ç–∞!")
    print("–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: —Å–æ–∑–¥–∞–¥–∏–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.")

if __name__ == "__main__":
    main()